{
   "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "hostingPlanName": {
         "type": "string",
         "minLength": 1,
         "metadata": {
            "description": "Name of the hosting plan to use in Azure."
         }
      },
      "webSiteName": {
         "type": "string",
         "minLength": 1,
         "metadata": {
            "description": "Name of the Azure Web app to create."
         }
      },
      "containerregistry_username": {
         "type": "string"
      },
      "containerregistry_password": {
         "type": "string"
      },
      "containerregistry": {
         "type": "string"
      },
      "image_tag": {
         "type": "string"
      },
      "image_port": {
         "type": "string"
      },
      "skuName": {
         "type": "string",
         "defaultValue": "S1",
         "allowedValues": [
            "F1",
            "D1",
            "B1",
            "B2",
            "B3",
            "S1",
            "S2",
            "S3",
            "P1",
            "P2",
            "P3",
            "P4"
         ],
         "metadata": {
            "description": "Describes plan's pricing tier and instance size. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/"
         }
      },
      "skuCapacity": {
         "type": "int",
         "defaultValue": 1,
         "minValue": 1,
         "metadata": {
            "description": "Describes plan's instance count"
         }
      }
   },
   "resources": [{
         "apiVersion": "2015-08-01",
         "name": "[parameters('webSiteName')]",
         "type": "Microsoft.Web/sites",
         "location": "[resourceGroup().location]",
         "tags": {
            "[concat('hidden-related:', resourceGroup().id,'Microsoft.Web/serverfarms', parameters('hostingPlanName'))]": "Resource",
            "displayName": "Website"
         },
         "dependsOn": [
            "[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
         ],
         "kind": "WebApp",
         "properties": {
            "name": "[parameters('webSiteName')]",
            "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]",
            "kind": "WebApp"
         },
         "resources": [{
            "apiVersion": "2015-08-01",
            "name": "appsettings",
            "type": "config",
            "dependsOn": [
               "[concat('Microsoft.Web/Sites/', parameters('webSiteName'))]"
            ],
            "properties": {
               "DOCKER_REGISTRY_SERVER_URL": "[parameters('containerregistry')]",
               "DOCKER_REGISTRY_SERVER_USERNAME": "[parameters('containerregistry_username')]",
               "DOCKER_REGISTRY_SERVER_PASSWORD": "[parameters('containerregistry_password')]",
               "DOCKER_CUSTOM_IMAGE_NAME": "[parameters('image_tag')]",
               "PORT": "[parameters('image_port')]"
            }
         }]
      },
      {
         "apiVersion": "2015-08-01",
         "name": "[parameters('hostingPlanName')]",
         "type": "Microsoft.Web/serverfarms",
         "location": "[resourceGroup().location]",
         "tags": {
            "displayName": "HostingPlan"
         },
         "sku": {
            "name": "[parameters('skuName')]",
            "capacity": "[parameters('skuCapacity')]"
         },
         "kind": "linux",
         "properties": {
            "name": "[parameters('hostingPlanName')]",
            "workerSizeId": "0",
            "reserved": true
         }
      }
   ]
}